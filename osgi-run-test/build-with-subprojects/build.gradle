buildscript {
    repositories {
        mavenCentral()
    }

    dependencies {
        classpath 'org.dm.gradle:gradle-bundle-plugin:0.8.2'
    }
}

apply plugin: 'com.athaydes.osgi-run'

allprojects {
    apply plugin: 'idea'

    repositories {
        mavenLocal()
        mavenCentral()
    }
}

subprojects {
    afterEvaluate { project ->
        project.jar.doLast {
            project.jar.manifest.writeTo( project.file( 'generated-sources/MANIFEST.MF' ) )
        }
    }
}

dependencies {
    osgiRuntime 'org.apache.commons:commons-lang3:3.3.2'
}

runOsgi {
    bundles += subprojects
    config += [ 'org.osgi.framework.storage.clean': 'onFirstInit' ]

    // OSGi bundles should not be included in the runtime
    excludedBundles = [ 'org.osgi.*' ]
}
